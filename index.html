<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minesweeper 10x10</title>
  <style>
    body { font-family: sans-serif; background: #222; color: #eee; text-align: center; }
    h1 { margin: 24px 0 12px; }
    #board { display: grid; grid-template-columns: repeat(10, 32px); grid-gap: 2px; justify-content: center; margin: 20px auto; }
    .cell {
      width: 32px; height: 32px; background: #444; color: #ddd;
      border: none; font-size: 20px; cursor: pointer; outline: none;
      display: flex; align-items: center; justify-content: center;
      user-select: none;
      touch-action: manipulation;
    }
    .cell.revealed { background: #ccc; color: #222; cursor: default; }
    .cell.mine { background: #d9534f; color: #fff; }
    .cell.flagged { background: #f0ad4e; color: #222; }
    .cell.wrong { background: #b85c00; color: #fff; }
    #reset { margin: 20px; padding: 6px 16px; font-size: 16px; }
    #status { margin-top: 10px; }
    #fireworks-canvas, #rain-canvas { position: fixed; top:0; left:0; width:100vw; height:100vh; pointer-events: none; z-index:1000; display:none; }
  </style>
</head>
<body>
  <h1>10x10 Minesweeper</h1>
  <button id="reset">Restart</button>
  <div id="status"></div>
  <div id="board"></div>
  <canvas id="fireworks-canvas"></canvas>
  <canvas id="rain-canvas"></canvas>
  <script>
    const SIZE = 10, MINES = 15;
    let board, revealed, flagged, mineCount, gameOver, gameWon;

    function createBoard() {
      board = Array.from({length: SIZE}, () => Array(SIZE).fill(0));
      revealed = Array.from({length: SIZE}, () => Array(SIZE).fill(false));
      flagged = Array.from({length: SIZE}, () => Array(SIZE).fill(false));
      mineCount = MINES; gameOver = false; gameWon = false;
      hideFireworks(); hideRain();
      // Place mines
      let placed = 0;
      while (placed < MINES) {
        let r = Math.floor(Math.random() * SIZE), c = Math.floor(Math.random() * SIZE);
        if (board[r][c] === 'M') continue;
        board[r][c] = 'M';
        placed++;
      }
      // Fill numbers
      for(let r=0; r<SIZE; r++) {
        for(let c=0; c<SIZE; c++) {
          if(board[r][c]==='M') continue;
          let mines = 0;
          for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++)
            if(r+dr>=0 && r+dr<SIZE && c+dc>=0 && c+dc<SIZE && board[r+dr][c+dc]==='M') mines++;
          board[r][c]=mines;
        }
      }
    }
    function renderBoard() {
      const b=document.getElementById('board'); b.innerHTML='';
      for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) {
        const cell=document.createElement('button');
        cell.className='cell';
        cell.dataset.row=r; cell.dataset.col=c;
        // After losing: show where the user made mistakes
        if (gameOver && !gameWon) {
          cell.classList.add('revealed');
          if (board[r][c] === 'M' && flagged[r][c]) {
            cell.classList.add('flagged');
            cell.textContent = 'ğŸš©';
          } else if (board[r][c] === 'M' && !flagged[r][c]) {
            cell.classList.add('mine');
            cell.textContent = 'ğŸ’£';
          } else if (board[r][c] !== 'M' && flagged[r][c]) {
            cell.classList.add('wrong');
            cell.textContent = 'âŒ';
          } else if (board[r][c] !== 'M' && board[r][c]) {
            cell.textContent = board[r][c];
          }
        } else if(revealed[r][c]){
          cell.classList.add('revealed');
          if(board[r][c]==='M') cell.classList.add('mine'), cell.textContent='ğŸ’£';
          else if(board[r][c]) cell.textContent=board[r][c];
        } else if(flagged[r][c]) {
          cell.classList.add('flagged');
          cell.textContent='ğŸš©';
        } 
        if(!revealed[r][c]) {
          cell.addEventListener('contextmenu', e => {e.preventDefault(); flag(r,c);});
          cell.addEventListener('click',()=>reveal(r,c));
          // Long press for mobile - toggle flag
          let pressTimer;
          cell.addEventListener('touchstart',function(e){
            pressTimer = setTimeout(() => { flag(r,c); }, 500);
          });
          cell.addEventListener('touchend',function(e){
            clearTimeout(pressTimer);
          });
          cell.addEventListener('touchmove',function(e){
            clearTimeout(pressTimer);
          });
        }
        b.appendChild(cell);
      }
      if (gameWon) {
        document.getElementById('status').textContent = 'ğŸ‰ You win!';
      } else if (gameOver) {
        document.getElementById('status').textContent = 'You lost, try again';
      } else {
        document.getElementById('status').textContent = 'Mines: '+mineCount+' | ×œ×—×™×¦×” ××¨×•×›×” ×‘××•×‘×™×™×œ/×§×œ×™×§ ×™×× ×™ ××¡××Ÿ ×“×’×œ';
      }
    }
    function flag(r,c){
      if(revealed[r][c]||gameOver) return;
      flagged[r][c]=!flagged[r][c];
      mineCount+=flagged[r][c]? -1:1;
      renderBoard();
    }
    function reveal(r,c){
      if(flagged[r][c]||revealed[r][c]||gameOver)return;
      revealed[r][c]=true;
      if(board[r][c]==='M'){ gameOver=true; gameWon=false; revealAll(); showRain(); }
      else if(board[r][c]===0) flood(r,c);
      if(!gameOver && checkWin()) { gameOver=true; gameWon=true; showFireworks(); }
      renderBoard();
    }
    function revealAll(){
      for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) revealed[r][c]=true;
    }
    function flood(r,c){
      for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
        let nr=r+dr,nc=c+dc;
        if(nr>=0 && nr<SIZE && nc>=0 && nc<SIZE && !(dr===0&&dc===0)&&!revealed[nr][nc]&&board[nr][nc]!=='M'){
          revealed[nr][nc]=true;
          if(board[nr][nc]===0) flood(nr,nc);
        }
      }
    }
    function checkWin(){
      let safe=0;
      for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) safe+=(revealed[r][c]||board[r][c]==='M');
      return safe===SIZE*SIZE;
    }
    document.getElementById('reset').onclick=()=>{createBoard();renderBoard();}
    createBoard();renderBoard();

    // --- Fireworks animation ---
    function showFireworks() {
      if (!gameWon) return;
      const canvas = document.getElementById('fireworks-canvas');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.display = 'block';
      let ctx = canvas.getContext('2d');
      let particles = [];
      function randomColor() {
        const colors = ['#ff3', '#f39', '#3cf', '#fc3', '#3fa', '#f66', '#8ff'];
        return colors[Math.floor(Math.random()*colors.length)];
      }
      for(let i=0;i<6;i++) {
        let x = Math.random()*canvas.width, y = canvas.height*0.6;
        let color = randomColor();
        for(let j=0;j<60;j++) {
          let angle = 2*Math.PI * j/60, speed=2+2*Math.random();
          particles.push({x,y,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,color,life:60});
        }
      }
      function animate() {
        ctx.globalAlpha = 0.25;
        ctx.fillStyle = '#222';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.globalAlpha = 1.0;
        let alive = false;
        for(const p of particles) {
          if(p.life>0) {
            alive=true;
            ctx.beginPath();
            ctx.arc(p.x,p.y,2,0,2*Math.PI);
            ctx.fillStyle=p.color;
            ctx.fill();
            p.x += p.vx; p.y += p.vy;
            p.vy += 0.06; // gravity
            p.life--;
          }
        }
        if(alive) requestAnimationFrame(animate);
        else hideFireworks();
      }
      animate();
    }
    function hideFireworks(){
      const canvas = document.getElementById('fireworks-canvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);
      canvas.style.display = 'none';
    }

    // --- Simple Rain animation ---
    function showRain() {
      if (!gameOver || gameWon) return;
      const canvas = document.getElementById('rain-canvas');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.display = 'block';
      let ctx = canvas.getContext('2d');
      let drops = Array.from({length: 70},()=>({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height*0.7,
        len: 8+Math.random()*12,
        sy: 4+Math.random()*5
      }));
      const startedAt = performance.now();
      const DURATION_MS = 3500;
      function animate(now) {
        // Auto-stop after a short "sad rain" effect, or when game state changes.
        if (!gameOver || gameWon || (now - startedAt) > DURATION_MS) {
          hideRain();
          return;
        }
        ctx.globalAlpha=0.3;
        ctx.fillStyle='#222';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.globalAlpha=1.0;
        ctx.strokeStyle='#3af';
        ctx.lineWidth=2;
        for(const d of drops) {
          ctx.beginPath();
          ctx.moveTo(d.x,d.y);
          ctx.lineTo(d.x,d.y+d.len);
          ctx.stroke();
          d.y += d.sy;
          if(d.y > canvas.height) d.y = -20;
        }
        requestAnimationFrame(animate);
      }
      requestAnimationFrame(animate);
    }
    function hideRain(){
      const canvas = document.getElementById('rain-canvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);
      canvas.style.display = 'none';
    }
  </script>
</body>
</html>
